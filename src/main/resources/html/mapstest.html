<!DOCTYPE html>
<html>
<head>
    <title>SSE Test</title>
    <meta charset="utf-8" />
    <script language="JavaScript">
        function init() {
            if(typeof(EventSource)!=="undefined") {
                var log = document.getElementById('log');
                if (log) {
                    log.innerHTML = "EventSource() testing begins..<br>";
                }

                var svrEvents = new EventSource('/stream');

                svrEvents.onopen = function() {
                    connectionOpen(true);
                }

                svrEvents.onerror = function() {
                    connectionOpen(false);
                }

                svrEvents.addEventListener('poll', displayPoll, false);             // display multi choice and send back answer

                svrEvents.onmessage = function(event) {
                    var log = document.getElementById('log');
                    if (log) {
                        log.innerHTML += 'message: ' + event.data + "<br>";
                    }
                    // absorb any other messages
                }
            } else {
                var log = document.getElementById('log');
                if (log) {
                    log.innerHTML = "EventSource() not supported<br>";
                }
            }
        }

        function connectionOpen(status) {
            var log = document.getElementById('log');
            if (log) {
                log.innerHTML += 'connected: ' + status + "<br>";
            }
        }

        function displayPoll(event) {
            var html = event.data;
            var log = document.getElementById('log');
            if (log) {
                log.innerHTML += 'poll: ' + html + "<br>";
            }
        }
    </script>
</head>
<body onLoad="init()">
<div id="log">testing...</div>
</body>
</html>